/*******************************************************************************
* KindEditor - WYSIWYG HTML Editor for Internet
* Copyright (C) 2006-2011 kindsoft.net
*
* @author Roddy <luolonghao@gmail.com>
* @site http://www.kindsoft.net/
* @licence http://www.kindsoft.net/license.php
*******************************************************************************/
KindEditor.plugin("filemanager",function(e){function o(e,t,n){return e+" ("+Math.ceil(t/1024)+"KB, "+n+")"}function u(e,t){t.is_dir?e.attr("title",t.filename):e.attr("title",o(t.filename,t.filesize,t.datetime))}var t=this,n="filemanager",r=e.undef(t.fileManagerJson,t.basePath+"php/file_manager_json.php"),i=t.pluginsPath+n+"/images/",s=t.lang(n+".");t.plugin.filemanagerDialog=function(o){function S(n,i,s){var o="path="+n+"&order="+i+"&dir="+l;d.showLoading(t.lang("ajaxLoading")),e.ajax(e.addParam(r,o+"&"+(new Date).getTime()),function(e){d.hideLoading(),s(e)})}function T(t,n,r,i){var s=e.formatUrl(n.current_url+r.filename,"absolute"),o=encodeURIComponent(n.current_dir_path+r.filename+"/");r.is_dir?t.click(function(e){S(o,E.val(),i)}):r.is_photo?t.click(function(e){h.call(this,s,r.filename)}):t.click(function(e){h.call(this,s,r.filename)}),x.push(t)}function N(t,n){function r(){w.val()=="VIEW"?S(t.current_dir_path,E.val(),k):S(t.current_dir_path,E.val(),C)}e.each(x,function(){this.unbind()}),y.unbind(),w.unbind(),E.unbind(),t.current_dir_path&&y.click(function(e){S(t.moveup_dir_path,E.val(),n)}),w.change(r),E.change(r),m.html("")}function C(t){N(t,C);var n=document.createElement("table");n.className="ke-table",n.cellPadding=0,n.cellSpacing=0,n.border=0,m.append(n);var r=t.file_list;for(var o=0,u=r.length;o<u;o++){var a=r[o],f=e(n.insertRow(o));f.mouseover(function(t){e(this).addClass("ke-on")}).mouseout(function(t){e(this).removeClass("ke-on")});var l=i+(a.is_dir?"folder-16.gif":"file-16.gif"),c=e('<img src="'+l+'" width="16" height="16" alt="'+a.filename+'" align="absmiddle" />'),h=e(f[0].insertCell(0)).addClass("ke-cell ke-name").append(c).append(document.createTextNode(" "+a.filename));!a.is_dir||a.has_file?(f.css("cursor","pointer"),h.attr("title",a.filename),T(h,t,a,C)):h.attr("title",s.emptyFolder),e(f[0].insertCell(1)).addClass("ke-cell ke-size").html(a.is_dir?"-":Math.ceil(a.filesize/1024)+"KB"),e(f[0].insertCell(2)).addClass("ke-cell ke-datetime").html(a.datetime)}}function k(t){N(t,k);var n=t.file_list;for(var r=0,o=n.length;r<o;r++){var a=n[r],f=e('<div class="ke-inline-block ke-item"></div>');m.append(f);var l=e('<div class="ke-inline-block ke-photo"></div>').mouseover(function(t){e(this).addClass("ke-on")}).mouseout(function(t){e(this).removeClass("ke-on")});f.append(l);var c=t.current_url+a.filename,h=a.is_dir?i+"folder-64.gif":a.is_photo?c:i+"file-64.gif",p=e('<img src="'+h+'" width="80" height="80" alt="'+a.filename+'" />');!a.is_dir||a.has_file?(l.css("cursor","pointer"),u(l,a),T(l,t,a,k)):l.attr("title",s.emptyFolder),l.append(p),f.append('<div class="ke-name" title="'+a.filename+'">'+a.filename+"</div>")}}var a=e.undef(o.width,650),f=e.undef(o.height,510),l=e.undef(o.dirName,""),c=e.undef(o.viewType,"VIEW").toUpperCase(),h=o.clickFn,p=['<div style="padding:10px 20px;">','<div class="ke-plugin-filemanager-header">','<div class="ke-left">','<img class="ke-inline-block" name="moveupImg" src="'+i+'go-up.gif" width="16" height="16" border="0" alt="" /> ','<a class="ke-inline-block" name="moveupLink" href="javascript:;">'+s.moveup+"</a>","</div>",'<div class="ke-right">',s.viewType+' <select class="ke-inline-block" name="viewType">','<option value="VIEW">'+s.viewImage+"</option>",'<option value="LIST">'+s.listImage+"</option>","</select> ",s.orderType+' <select class="ke-inline-block" name="orderType">','<option value="NAME">'+s.fileName+"</option>",'<option value="SIZE">'+s.fileSize+"</option>",'<option value="TYPE">'+s.fileType+"</option>","</select>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-plugin-filemanager-body"></div>',"</div>"].join(""),d=t.createDialog({name:n,width:a,height:f,title:t.lang(n),body:p}),v=d.div,m=e(".ke-plugin-filemanager-body",v),g=e('[name="moveupImg"]',v),y=e('[name="moveupLink"]',v),b=e('[name="viewServer"]',v),w=e('[name="viewType"]',v),E=e('[name="orderType"]',v),x=[];return w.val(c),S("",E.val(),c=="VIEW"?k:C),d}});